@startuml Circuit Breaker - Diagrama de Estados

' Definir colores para los estados
skinparam state {
  BackgroundColor<<closed>> LightGreen
  BackgroundColor<<open>> LightCoral
  BackgroundColor<<halfopen>> LightYellow
  BorderColor Black
  FontSize 14
}

[*] --> Closed : Inicio del sistema

state Closed <<closed>> {
  Closed : âœ… Estado normal
  Closed : â€¢ Todas las peticiones pasan
  Closed : â€¢ Contabiliza Ã©xitos y fallos
  Closed : â€¢ Calcula % de error
}

state Open <<open>> {
  Open : ðŸš« Circuito abierto
  Open : â€¢ Rechaza peticiones inmediatamente
  Open : â€¢ Activa funciÃ³n fallback
  Open : â€¢ No intenta conectar al servicio
  Open : â€¢ Temporizador activo (60s)
}

state HalfOpen <<halfopen>> {
  HalfOpen : ðŸ”„ Estado de prueba
  HalfOpen : â€¢ Permite 1 peticiÃ³n de prueba
  HalfOpen : â€¢ EvalÃºa si el servicio se recuperÃ³
  HalfOpen : â€¢ Decide siguiente estado
}

Closed --> Open : Fallos >= 50%\nen ventana de 10s
Open --> HalfOpen : Transcurrieron\n60 segundos
HalfOpen --> Closed : PeticiÃ³n de\nprueba exitosa
HalfOpen --> Open : PeticiÃ³n de\nprueba falla

note right of Closed
  **ConfiguraciÃ³n:**
  â€¢ Umbral: 50% de fallos
  â€¢ Ventana: 10 segundos
  â€¢ Volumen mÃ­nimo: 5 peticiones
end note

note right of Open
  **Fallback activo:**
  â€¢ Status: pending
  â€¢ Encolar pago
  â€¢ HTTP 202 Accepted
end note

note right of HalfOpen
  **Auto-recuperaciÃ³n:**
  â€¢ Timeout: 60 segundos
  â€¢ 1 intento de prueba
  â€¢ Si OK â†’ CLOSED
end note

@enduml
